<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>flashml.test &#8212; flashml 0.5.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=b9afe91b"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for flashml.test</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="test_rl_info">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_rl_info">[docs]</a>
<span class="k">def</span> <span class="nf">test_rl_info</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">rl</span> <span class="kn">import</span> <span class="n">log_episode</span>

    <span class="n">reward_bias</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_steps</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">max_steps</span><span class="p">:</span>
        <span class="n">ep_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4096</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ep_len</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="n">log_episode</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">+</span> <span class="n">reward_bias</span><span class="p">,</span>
                    <span class="n">ep_len</span><span class="p">,</span>
                    <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">max_steps</span><span class="p">),</span>
                    <span class="n">other_metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Rand&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()},</span>
                    <span class="n">experiment_name</span><span class="o">=</span><span class="s2">&quot;flashml_rl2&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ep_len</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">reward_bias</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">step</span> <span class="o">/</span> <span class="n">max_steps</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_train_info">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_train_info">[docs]</a>
<span class="k">def</span> <span class="nf">test_train_info</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">log_metrics</span>

    <span class="n">HYPERPARAMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen3-0.6B&quot;</span><span class="p">,</span>  <span class="c1"># &quot;tiiuae/Falcon-H1-0.5B-Base&quot;,</span>
        <span class="s2">&quot;continue_from_index&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;gradient_accumulation&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;epochs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">2e-5</span><span class="p">,</span>
        <span class="s2">&quot;betas&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">),</span>
        <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">batches</span> <span class="o">=</span> <span class="mi">300</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batches</span> <span class="o">*</span> <span class="n">epochs</span><span class="p">):</span>
            <span class="n">loss_</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">loss</span><span class="p">))</span>
            <span class="n">acc</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="n">log_metrics</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss_</span><span class="p">,</span> <span class="s2">&quot;acc&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">},</span>
                <span class="c1"># step=(epoch, batches * epochs),</span>
                <span class="n">hyperparams</span><span class="o">=</span><span class="n">HYPERPARAMS</span><span class="p">,</span>
                <span class="c1"># experiment_name=None,</span>
            <span class="p">)</span>
            <span class="n">loss</span> <span class="o">-=</span> <span class="mf">1e-2</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.0002</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_plotting">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_plotting">[docs]</a>
<span class="k">def</span> <span class="nf">test_plotting</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_graph</span>
    <span class="c1"># values = [10, 15, 17, 18, 18.3]</span>
    <span class="c1"># values2 = [9, 14, 17.5, 19, 20.1]</span>
    <span class="c1"># values3 = [10, 14.2, 17.7, 19.2, 20.3]</span>
    <span class="c1">#</span>
    <span class="c1"># plot_graph((values, values2, values3), marker=&quot;.&quot;)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
    <span class="n">plot_graph</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_conf_matrix">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_conf_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">test_conf_matrix</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_confusion_matrix</span>

    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
    <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_scheduler">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_scheduler">[docs]</a>
<span class="k">def</span> <span class="nf">test_scheduler</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">schedulers</span> <span class="kn">import</span> <span class="n">LRConsineAnnealingWithLinearWarmup</span>
    <span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
    <span class="kn">import</span> <span class="nn">torch</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">sched</span> <span class="o">=</span> <span class="n">LRConsineAnnealingWithLinearWarmup</span><span class="p">(</span>
        <span class="n">optimizer</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">warmup_steps_ratio</span><span class="o">=</span><span class="mf">0.03</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sched</span><span class="o">.</span><span class="n">warmup_steps</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_logging">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_logging">[docs]</a>
<span class="k">def</span> <span class="nf">test_logging</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">ansi_of</span><span class="p">,</span> <span class="n">hex_of</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">log_record</span><span class="p">,</span> <span class="n">display_logs</span>

    <span class="n">log_record</span><span class="p">(</span><span class="s2">&quot;This is red&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>  <span class="c1"># Entire text in red</span>
    <span class="n">log_record</span><span class="p">(</span><span class="s2">&quot;This is hex blue&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#0000FF&quot;</span><span class="p">)</span>  <span class="c1"># Entire text in blue (hex)</span>
    <span class="n">log_record</span><span class="p">(</span>
        <span class="s2">&quot;This is a test message</span><span class="se">\n</span><span class="s2"> with a new line and some random characters:   &quot;</span>
    <span class="p">)</span>  <span class="c1"># Entire text in white</span>
    <span class="n">log_record</span><span class="p">(</span><span class="s2">&quot;This is hex green&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#00FF00&quot;</span><span class="p">)</span>  <span class="c1"># Entire text in green (hex)</span>
    <span class="n">log_record</span><span class="p">(</span><span class="s2">&quot;Khaki hex&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;khaki&quot;</span><span class="p">)</span>
    <span class="n">display_logs</span><span class="p">()</span></div>



<div class="viewcode-block" id="test_rt_plotting">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_rt_plotting">[docs]</a>
<span class="k">def</span> <span class="nf">test_rt_plotting</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_rt_graph</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
        <span class="n">plot_rt_graph</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_graph&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()],</span>
            <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span>
            <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">),</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="c1"># exit()</span>
    <span class="c1"># plot_rt_graph(</span>
    <span class="c1">#     name=&quot;test_graph&quot;,</span>
    <span class="c1">#     value=[random.random() * 10, random.random()],</span>
    <span class="c1">#     step = None,</span>
    <span class="c1">#     x_label=&quot;Time&quot;,</span>
    <span class="c1">#     y_label=&quot;Value&quot;,</span>
    <span class="c1">#     color=(&quot;lightblue&quot;, &quot;yellow&quot;),</span>
    <span class="c1">#     linestyle=[&quot;--&quot;, &quot;-&quot;],</span>
    <span class="c1"># )</span>


<div class="viewcode-block" id="test_log_session">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_log_session">[docs]</a>
<span class="k">def</span> <span class="nf">test_log_session</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">example_train_function</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">example_train_function2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;acc&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">99</span><span class="p">}</span>

    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">log_session</span>

    <span class="n">hyperparams1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;dang&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams1</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">hyperparams2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.002</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;dropout&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams2</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>

    <span class="n">hyperparams3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.003</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams3</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>

    <span class="n">hyperparams3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.002</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;manag&quot;</span><span class="p">:</span> <span class="s2">&quot;pick&quot;</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams3</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>

    <span class="n">log_session</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">)</span>

    <span class="n">hyperparams4</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;dropout&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams4</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>

    <span class="n">hyperparams5</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.003</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;lavander&quot;</span><span class="p">:</span> <span class="s2">&quot;lander&quot;</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams5</span><span class="p">,</span> <span class="n">example_train_function</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>

    <span class="n">hyperparams5</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.003</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;lavander&quot;</span><span class="p">:</span> <span class="s2">&quot;lander&quot;</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams5</span><span class="p">,</span> <span class="n">example_train_function2</span><span class="p">)</span>

    <span class="n">hyperparams6</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.003</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
    <span class="n">log_session</span><span class="p">(</span><span class="n">hyperparams6</span><span class="p">,</span> <span class="n">example_train_function2</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;acc&quot;</span><span class="p">)</span>

    <span class="n">log_session</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">)</span></div>



<span class="kn">from</span> <span class="nn">flashml.main_tools</span> <span class="kn">import</span> <span class="n">parallel</span>
<span class="kn">from</span> <span class="nn">nlp</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="test_plot_dist">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_plot_dist">[docs]</a>
<span class="k">def</span> <span class="nf">test_plot_dist</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_distribution</span>

    <span class="c1"># Create a fake frequency dictionary with 100 token IDs</span>
    <span class="n">fake_freqs</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)}</span>

    <span class="c1"># Run test plot</span>
    <span class="n">plot_distribution</span><span class="p">(</span><span class="n">fake_freqs</span><span class="p">,</span> <span class="n">sort_descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></div>



<div class="viewcode-block" id="stress_test">
<a class="viewcode-back" href="../../flashml.html#flashml.test.stress_test">[docs]</a>
<span class="k">def</span> <span class="nf">stress_test</span><span class="p">():</span>
    <span class="n">stress_gpu</span><span class="p">()</span></div>



<div class="viewcode-block" id="test_logger">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_logger">[docs]</a>
<span class="k">def</span> <span class="nf">test_logger</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">log_record</span><span class="p">,</span> <span class="n">load_records</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">load_records</span><span class="p">(</span><span class="n">as_df</span><span class="o">=</span><span class="s2">&quot;pl&quot;</span><span class="p">))</span></div>



<div class="viewcode-block" id="test_simple_for">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_simple_for">[docs]</a>
<span class="k">def</span> <span class="nf">test_simple_for</span><span class="p">():</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>



<div class="viewcode-block" id="test_parallel_for">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_parallel_for">[docs]</a>
<span class="k">def</span> <span class="nf">test_parallel_for</span><span class="p">():</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">parallel_foreach</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_tensorx">
<a class="viewcode-back" href="../../flashml.html#flashml.test.plot_tensorx">[docs]</a>
<span class="k">def</span> <span class="nf">plot_tensorx</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">torch</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_tensor</span>

    <span class="n">plot_tensor</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">121</span><span class="p">))</span></div>



<div class="viewcode-block" id="test_batch_generation">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_batch_generation">[docs]</a>
<span class="k">def</span> <span class="nf">test_batch_generation</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">BatchIterator</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">BatchIterator</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">BatchIterator</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_plot_tsne">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_plot_tsne">[docs]</a>
<span class="k">def</span> <span class="nf">test_plot_tsne</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">plot_tsne</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">plot_tsne</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="log_metrics_test">
<a class="viewcode-back" href="../../flashml.html#flashml.test.log_metrics_test">[docs]</a>
<span class="k">def</span> <span class="nf">log_metrics_test</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">flashml</span> <span class="kn">import</span> <span class="n">log_metrics</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">log_metrics</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()},</span>
                <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">hyperparams</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_metrics</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()},</span>
                <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span></div>



<div class="viewcode-block" id="test_nlp_preprocesssing">
<a class="viewcode-back" href="../../flashml.html#flashml.test.test_nlp_preprocesssing">[docs]</a>
<span class="k">def</span> <span class="nf">test_nlp_preprocesssing</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">string</span>

    <span class="c1"># Seed for reproducibility</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Lists for generating varied text</span>
    <span class="n">nouns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;dog&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;banana&quot;</span><span class="p">,</span>
        <span class="s2">&quot;phone&quot;</span><span class="p">,</span>
        <span class="s2">&quot;book&quot;</span><span class="p">,</span>
        <span class="s2">&quot;car&quot;</span><span class="p">,</span>
        <span class="s2">&quot;house&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;computer&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">verbs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;have&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bought&quot;</span><span class="p">,</span>
        <span class="s2">&quot;run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;see&quot;</span><span class="p">,</span>
        <span class="s2">&quot;write&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;build&quot;</span><span class="p">,</span>
        <span class="s2">&quot;play&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sing&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">adjectives</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;happy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;big&quot;</span><span class="p">,</span>
        <span class="s2">&quot;small&quot;</span><span class="p">,</span>
        <span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fast&quot;</span><span class="p">,</span>
        <span class="s2">&quot;slow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;new&quot;</span><span class="p">,</span>
        <span class="s2">&quot;old&quot;</span><span class="p">,</span>
        <span class="s2">&quot;smart&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">emojis</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;🐈&quot;</span><span class="p">,</span> <span class="s2">&quot;🐶&quot;</span><span class="p">,</span> <span class="s2">&quot;♥️&quot;</span><span class="p">,</span> <span class="s2">&quot;😊&quot;</span><span class="p">,</span> <span class="s2">&quot;⭐&quot;</span><span class="p">,</span> <span class="s2">&quot;🚗&quot;</span><span class="p">,</span> <span class="s2">&quot;🍎&quot;</span><span class="p">,</span> <span class="s2">&quot;🍌&quot;</span><span class="p">,</span> <span class="s2">&quot;📱&quot;</span><span class="p">,</span> <span class="s2">&quot;🏠&quot;</span><span class="p">]</span>
    <span class="n">special_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">generate_sentence</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a single random sentence similar to the provided example.&quot;&quot;&quot;</span>
        <span class="n">sentence_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;quantity&quot;</span><span class="p">,</span> <span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;fact&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sentence_type</span> <span class="o">==</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span>
            <span class="c1"># Example: &quot;I bought 5 apples and 3 bananas.&quot;</span>
            <span class="n">num1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">num2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">noun1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nouns</span><span class="p">)</span>
            <span class="n">noun2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nouns</span><span class="p">)</span>
            <span class="n">verb</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">verbs</span><span class="p">)</span>
            <span class="n">emoji</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">emojis</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">special_chars</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;I </span><span class="si">{</span><span class="n">verb</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">num1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">noun1</span><span class="si">}</span><span class="s2">s and </span><span class="si">{</span><span class="n">num2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">noun2</span><span class="si">}</span><span class="s2">s</span><span class="si">{</span><span class="n">emoji</span><span class="si">}{</span><span class="n">special</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">sentence_type</span> <span class="o">==</span> <span class="s2">&quot;phone&quot;</span><span class="p">:</span>
            <span class="c1"># Example: &quot;My phone number is 1234567890.&quot;</span>
            <span class="n">phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">special_chars</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;My phone number is </span><span class="si">{</span><span class="n">phone</span><span class="si">}{</span><span class="n">special</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">sentence_type</span> <span class="o">==</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span>
            <span class="c1"># Example: &quot;The year is 2025.&quot;</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2030</span><span class="p">)</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">special_chars</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The year is </span><span class="si">{</span><span class="n">year</span><span class="si">}{</span><span class="n">special</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="n">sentence_type</span> <span class="o">==</span> <span class="s2">&quot;fact&quot;</span><span class="p">:</span>
            <span class="c1"># Example: &quot;The answer is 42.&quot;</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">noun</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nouns</span><span class="p">)</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">special_chars</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">noun</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">num</span><span class="si">}{</span><span class="n">special</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># mixed</span>
            <span class="c1"># Example: &quot;I have 2 dogs!.♥️🐈&quot;</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">noun</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nouns</span><span class="p">)</span>
            <span class="n">verb</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">verbs</span><span class="p">)</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">adjectives</span><span class="p">)</span>
            <span class="n">emoji</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">emojis</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">special_chars</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;I </span><span class="si">{</span><span class="n">verb</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">adj</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">noun</span><span class="si">}</span><span class="s2">s</span><span class="si">{</span><span class="n">emoji</span><span class="si">}{</span><span class="n">special</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Generate 10,000 sentences</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">generate_sentence</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)]}</span>

    <span class="c1"># Create pandas DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset created </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">lemmatize</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">end</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_nlp_preprocesssing</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">flashml</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">flashml</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, kbradu.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>